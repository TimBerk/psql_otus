# Триггеры, поддержка заполнения витрин

<p align="left">
    <a href="https://www.docker.com/" target="blank">
        <img src="https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white" />
    </a>
    <a href="https://www.postgresql.org/" target="blank">
        <img src="https://img.shields.io/badge/postgres-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white"/>
    </a>
</p>

В качестве рабочего окружения используется PostgreSQL 16 версии установленный в Docker.

Дополнительно устанавливается решение [asciinema](https://asciinema.org/) - для составления интерактивного отчета.


Каждый этап имеет следующую структуру:

* Номера затрагиваемых задач
* Краткий отчет о том, что было сделано
* Пример выполнения команд

## Оглавление

- [Задание](#задание)
- [Практика](#практика)

### Задание

1. Скрипт и развернутое описание задачи – в ЛК (файл hw_triggers.sql) или по ссылке: https://disk.yandex.ru/d/l70AvknAepIJXQ
2. В БД создана структура, описывающая товары (таблица `goods`) и продажи (таблица `sales`).
3. Есть запрос для генерации отчета – сумма продаж по каждому товару.
4. БД была денормализована, создана таблица (витрина), структура которой повторяет структуру отчета.
5. Создать триггер на таблице продаж, для поддержки данных в витрине в актуальном состоянии (вычисляющий при каждой продаже сумму и записывающий её в витрину)
6. Чем такая схема (витрина+триггер) предпочтительнее отчета, создаваемого "по требованию" (кроме производительности)? Подсказка: В реальной жизни возможны изменения цен.

### Практика

<details>
  <summary> ✔️ Работа с триггером</summary>

**Затрагиваемые задачи**: 1-5 

**Выполнение задания**:

Функция и триггер размещены в файле [report_trigger.sql](scripts%2Freport_trigger.sql). По средствам консольного клиента скрипт был применен. Также были протестированы операции добавления, обновления и удаления:

[![asciicast](https://asciinema.org/a/JV29DU5MOjng15InqHq7QqeCr.svg)](https://asciinema.org/a/JV29DU5MOjng15InqHq7QqeCr)

</details>


<details>
  <summary> ✔️ Преимущества использования витрины данных (data mart)</summary>

**Затрагиваемые задачи**: 6

**Выполнение задания**:

Использование витрины данных (data mart) с триггером для обновления данных предпочтительнее создания отчета "по требованию" по нескольким причинам:

1. **Согласованность данных**:
   - **Триггеры**: При использовании триггеров данные в витрине всегда актуальны, так как триггеры автоматически обновляют витрину при изменении данных в исходных таблицах.
   - **По требованию**: Отчет, создаваемый "по требованию", может содержать несогласованные или устаревшие данные, если между моментами изменения данных и созданием отчета проходит время.

2. **Управление изменениями**:
   - **Триггеры**: Триггеры могут быть настроены так, чтобы учитывать изменения цен и других параметров в реальном времени. Например, если цена товара изменяется, триггер может автоматически пересчитать сумму продаж с новой ценой.
   - **По требованию**: При изменении цен или других параметров необходимо вручную пересчитывать отчет, что может быть забыто или выполнено несвоевременно.

3. **Простота использования**:
   - **Триггеры**: Витрина данных, обновляемая триггерами, упрощает доступ к данным для пользователей и приложений, так как данные всегда готовы и актуальны.
   - **По требованию**: Пользователям или приложениям приходится каждый раз запрашивать обновление отчета, что может быть неудобно и приводить к ошибкам.

4. **Масштабируемость**:
   - **Триггеры**: Система с витриной и триггерами легче масштабируется, так как обновление данных происходит автоматически и не требует дополнительных действий со стороны пользователей.
   - **По требованию**: При увеличении объема данных и количества запросов на создание отчетов производительность системы может снижаться, требуя дополнительных оптимизаций.

5. **Логирование и аудит**:
   - **Триггеры**: Триггеры могут быть использованы для логирования изменений данных, что упрощает аудит и отслеживание истории изменений.
   - **По требованию**: Отслеживание изменений и аудит могут быть более сложными, так как каждый запрос на создание отчета требует отдельного учета.

В целом, использование витрины данных с триггерами обеспечивает более надежную, согласованную и управляемую систему, которая лучше адаптируется к изменениям в данных и требованиях бизнеса.

</details>